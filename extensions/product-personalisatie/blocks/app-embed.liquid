<!-- Simple Gifting App Embed -->
{% if block.settings.enabled %}
<script>
  // Initialize Simple Gifting app across all pages
  if (typeof SimpleGifting === 'undefined') {
    window.SimpleGifting = {
      isInitialized: false,
      
      init: function() {
        if (this.isInitialized) return;
        
        try {
          // Load the gifting app JavaScript
          this.loadScript('{{ "gifting-app.js" | asset_url }}')
            .then(() => {
              console.log('Simple Gifting utilities loaded successfully');
              this.loadStyles();
            })
            .catch(error => {
              console.error('Simple Gifting: Failed to load JavaScript:', error);
            });
          
          this.isInitialized = true;
        } catch (error) {
          console.error('Simple Gifting: Initialization error:', error);
        }
      },
      
      loadScript: function(src) {
        return new Promise((resolve, reject) => {
          // Check if script is already loaded
          if (document.querySelector(`script[src="${src}"]`)) {
            resolve();
            return;
          }
          
          const script = document.createElement('script');
          script.src = src;
          script.onload = resolve;
          script.onerror = reject;
          script.defer = true;
          document.head.appendChild(script);
        });
      },
      
      loadStyles: function() {
        // Check if styles are already loaded
        const styleHref = '{{ "gifting-styles.css" | asset_url }}';
        if (document.querySelector(`link[href="${styleHref}"]`)) {
          return;
        }
        
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = styleHref;
        link.onload = function() {
          console.log('Simple Gifting styles loaded successfully');
        };
        link.onerror = function() {
          console.error('Simple Gifting: Failed to load styles');
        };
        document.head.appendChild(link);
      }
    };
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        SimpleGifting.init();
      });
    } else {
      SimpleGifting.init();
    }
  }
</script>
{% endif %}

{% schema %}
{
  "name": "Simple Gifting",
  "target": "body",
  "settings": [
    {
      "type": "checkbox",
      "id": "enabled",
      "label": "Enable Simple Gifting",
      "default": true,
      "info": "Turn on to enable the Simple Gifting app across your store"
    }
  ]
}
{% endschema %}
